# Duragon Implementation Progress Log
#
# Instructions for implementors:
# - APPEND new entries to this file (never overwrite existing content)
# - Format: [YYYY-MM-DD HH:MM] task-id: description of what was done
# - When marking a task as passes: true in PRD.json, log it here
# - Include any blockers, decisions, or notes
#
# Example entries:
# [2025-01-15 14:30] setup-001: Initialized pnpm monorepo, created workspace config
# [2025-01-15 15:45] setup-002: Created Vite React app, verified dev server runs
# [2025-01-15 16:00] BLOCKER: Supabase CLI not installed, need to run npm install -g supabase
#
# ============================================================================
# PROGRESS LOG START
# ============================================================================

[2026-01-11 17:36] setup-001: Initialized npm monorepo with workspace configuration. Created root package.json with npm workspaces for apps/* and packages/*. Added .gitignore. Created apps/ and packages/ directories. Changed from pnpm to npm per user request.

[2026-01-11 18:15] setup-002: Configured Vite React application with TypeScript. Created apps/web using Vite react-ts template. Added path alias (@/) to vite.config.ts and tsconfig.app.json. Configured server port 5173. Verified build and dev server work correctly.

[2026-01-11 18:45] setup-003: Set up Tailwind CSS with proper configuration. Installed tailwindcss@3.4.17, postcss@8.4.47, autoprefixer@10.4.20 as dev dependencies. Created tailwind.config.js with content paths for index.html and src/**/*.{js,ts,jsx,tsx}. Created postcss.config.js with tailwindcss and autoprefixer plugins. Added @tailwind base/components/utilities directives to index.css. Added test Tailwind classes to App.tsx to verify integration.

[2026-01-11 19:40] setup-004: Initialized Supabase client configuration. Installed @supabase/supabase-js@2.49.4 as dependency. Created apps/web/.env.example with VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY placeholders. Created src/lib/supabase.ts with typed client using createClient<Database>. Added environment variable validation that throws if Supabase credentials are missing. Placeholder Database type ready to be replaced with generated types from supabase gen types.
[2026-01-11 22:05] setup-005: Created shared package for cross-package code. Created packages/shared with src/ directory structure including placeholder dice/ subdirectory. Configured package.json with npm workspace name @duragon/shared, using direct TypeScript source exports for bundler resolution. Configured tsconfig.json with ES2020 target and strict mode. Added @duragon/shared dependency to apps/web and verified import works by adding SHARED_VERSION display to App.tsx. Package uses Vite's native TypeScript resolution for development.

[2026-01-11 23:15] dice-001: Created dice parser for simple NdS expressions. Created packages/shared/src/dice/parser.ts with ParsedDice interface (count, sides) and parseDice() function. Supports parsing "1d20", "2d6", and implicit count "d20" (defaults to 1). Includes DiceParseError class for invalid expressions. Added validation for count (1-100) and sides (1-1000). Exports parseDice, DiceParseError, and ParsedDice type from dice module. TypeScript type check and build both pass.

[2026-01-11 21:26] dice-002: Extended dice parser to support modifiers (NdS+M, NdS-M). Updated DICE_REGEX to capture optional +/- modifier group. Added modifier field to ParsedDice interface (defaults to 0). Parser now correctly handles "1d20+5" -> {count: 1, sides: 20, modifier: 5} and "2d6-2" -> {count: 2, sides: 6, modifier: -2}. Updated documentation and examples. TypeScript type check and build pass for both shared package and web app.

[2026-01-11 21:29] dice-003: Extended dice parser to support keep highest/lowest expressions (kh/kl). Added KeepMode type ('highest' | 'lowest') and optional keep/keepCount fields to ParsedDice interface. Updated DICE_REGEX to capture optional kh/kl group with keep count. Parser now correctly handles "2d20kh1" -> {count: 2, sides: 20, modifier: 0, keep: 'highest', keepCount: 1}, "2d20kl1" -> {..., keep: 'lowest', keepCount: 1}, and "4d6kh3" -> {..., keep: 'highest', keepCount: 3}. Added validation that keepCount must be at least 1 and cannot exceed dice count. Exported KeepMode type from dice module. TypeScript type check and build pass for both shared package and web app.

[2026-01-11 21:45] dice-004: Extended dice parser to support drop highest/lowest expressions (dh/dl). Added DropMode type ('highest' | 'lowest') and optional drop/dropCount fields to ParsedDice interface. Updated DICE_REGEX to capture kh/kl/dh/dl notation. Parser now correctly handles "4d6dl1" -> {count: 4, sides: 6, modifier: 0, drop: 'lowest', dropCount: 1}, "3d20dh1" -> {..., drop: 'highest', dropCount: 1}, and "4d6dl1+2" -> {..., modifier: 2, drop: 'lowest', dropCount: 1}. Added validation that dropCount must be at least 1 and cannot drop all dice (dropCount < count). Exported DropMode type from dice module. TypeScript type check and build pass for both shared package and web app.

[2026-01-11 21:35] dice-005: Implemented dice roller with cryptographically secure random. Created packages/shared/src/dice/roller.ts with roll(), rollDie(), and rollDice() functions. Uses crypto.getRandomValues() with rejection sampling to ensure uniform distribution across any die size. Added DieResult interface tracking individual die value and kept status. Added RollResult interface with rolls array, subtotal (kept dice sum), modifier, and total. Implements keep highest/lowest logic (for advantage/disadvantage) and drop highest/lowest logic (for stat rolling). Exported roll, rollDie, rollDice functions and RollResult, DieResult types from dice module. TypeScript type check and web app build both pass.

[2026-01-11 22:00] dice-006: Marked as complete - functionality was already implemented in dice-005. The roller.ts already contains: keep highest (sort desc, take first N at lines 123-133), keep lowest (sort asc, take first N at lines 127-133), drop highest (sort desc, remove first N at lines 138-149), drop lowest (sort asc, remove first N at lines 141-149). RollResult includes rolls array with kept boolean, subtotal of kept dice, modifier, and total. No additional code changes needed.

[2026-01-11 21:40] dice-007: Created DiceInput component for expression entry. Created apps/web/src/components/dice/DiceInput.tsx with text input for dice expressions, roll button, form submission handling (Enter key and button click). Validates expressions using parseDice from @duragon/shared and displays DiceParseError messages in red below input. Supports clearOnRoll prop (optional), disabled state, and custom placeholder. Added components/dice/index.ts for exports. Updated App.tsx with working demo that shows dice rolls with individual die results, kept/dropped styling, modifiers, and totals. TypeScript type check and build both pass.

[2026-01-11 21:40] dice-008: Created DiceResult component for displaying dice roll results. Created apps/web/src/components/dice/DiceResult.tsx with DiceResultProps interface supporting result, label, rollerName, and timestamp. Component displays: dice expression with kh/kl/dh/dl notation, individual dice with blue background for kept and gray strikethrough for dropped, modifier display, and final total in green. Added breakdown showing calculation for complex rolls. Includes timestamp formatting and roller name display. Exported from components/dice/index.ts. Updated App.tsx to use DiceResult component with roll history (keeps last 10 rolls). TypeScript type check and build pass.

[2026-01-11 21:42] dice-009: Created DicePresets component for quick common rolls. Created apps/web/src/components/dice/DicePresets.tsx with preset buttons for standard D&D dice (d20, d12, d10, d8, d6, d4) and advantage (2d20kh1) / disadvantage (2d20kl1) rolls. Component accepts onRoll callback, disabled state, and optional custom presets array for future customization. Each button shows label with tooltip description on hover. Exported DicePresets component and DicePreset/DicePresetsProps types from components/dice/index.ts. Updated App.tsx to display presets below the dice input. TypeScript type check and build pass.

[2026-01-11 21:45] ui-001: Created Button component with variants. Created apps/web/src/components/ui/Button.tsx with forwardRef for proper ref forwarding. Supports four variants: primary (blue), secondary (gray), danger (red), ghost (transparent with hover). Supports three sizes: sm, md, lg. Implements disabled state with opacity and cursor changes. Implements loading state with animated SVG spinner. Uses Tailwind CSS classes matching existing dark theme patterns. Exported Button component and types (ButtonProps, ButtonVariant, ButtonSize) from components/ui/index.ts. TypeScript type check and build both pass.

[2026-01-11 21:47] ui-002: Created Input component with validation. Created apps/web/src/components/ui/Input.tsx with forwardRef for proper ref forwarding. Supports label prop displayed above input with proper htmlFor association. Supports error prop that displays red error message below input with aria-invalid and aria-describedby for accessibility. Supports disabled state with opacity and cursor changes. Supports four input types: text, email, password, number. Uses auto-generated IDs via useId() hook for label association. Follows dark theme patterns with gray-800 background, gray-600 border, and blue/red focus rings. Exported Input component and types (InputProps, InputType) from components/ui/index.ts. TypeScript type check and build both pass.
